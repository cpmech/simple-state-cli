import { Store } from '../../Store';
import { makeSetStringField, makePushModuleName, makeRemoveModuleName } from '../setters';
import { IState } from '../../types';

describe('module data: setters', () => {
  const store = new Store();
  const setStringField = makeSetStringField(store);
  const pushModuleName = makePushModuleName(store);
  const removeModuleName = makeRemoveModuleName(store);

  beforeEach(() => store.reset());

  it('makeSetStringField works', () => {
    const unsubscribe = store.subscribe((state: IState) => {
      expect(state.data.outputDirectory).toBe('/tmp/streamx/somewhere-else');
      expect(state.data.moduleNames).toBe('todo login');
    });
    setStringField('outputDirectory', '/tmp/streamx/somewhere-else');
    setStringField('moduleNames', 'todo login');
    unsubscribe();
  });

  it('setStringField throws error if fieldName is incorrect', () => {
    expect(() => setStringField('__inexistent__', 'hello')).toThrowError(
      'cannot find field "__inexistent__" in module "data"',
    );
  });

  /*
  it('pushModuleName works', () => {
    pushModuleName('colors fonts');
    expect(store.data.moduleNames).toEqual('auth user colors fonts');
  });

  it('removeModuleName works', () => {
    removeModuleName('auth');
    expect(store.data.moduleNames).toEqual('user');
  });
  */
});
